# âš™ ê°œë°œí™˜ê²½

**í˜•ìƒ ê´€ë¦¬**

- Gitlab

**ì´ìŠˆ ê´€ë¦¬**

- Jira

**Communication**

- Notion

**UI/UX**

- Figma

**OS**

- Windows 10

**IDE**

- IntelliJ 2022.3.1
- Visual Studio Code 1.75.1

**Database**

- Mysql 8.0.32
- Redis 7.0.8

**Server**

- AWS EC2
    - Ubuntu 20.04 LTS
    - Docker 23.0.0
    - docker-compose 2.15.1
    - nginx 1.18.0
    - openvidu 2.25.0
- Amazon S3

**ê¸°íƒ€ í¸ì˜ íˆ´**

- Postman 10.9.4
- Termius 7.56.1

**Front-End**

- React 18.2.0
- Nodejs 18.12.1
- mui 5.11.9

**Back-End**

- Java 11
- SpringBoot Gradle
    - Spring Data JPA 2.7.7
    - Spring Security 2.7.7
    - Lombok 1.18.24
    - Swagger 3.0.0
    - jwt 3.10.3

**CI/CD**

- Jenkins 2.375.2
    - Docker 23.0.0

# ğŸ³ í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ë°°í¬

- ~~í•˜ìœ„í˜ì´ì§€~~
    
    [Dockerfile(back)](https://www.notion.so/Dockerfile-back-ab2bf5311e8d43028e4afa8b0d8a0214)
    
    [Dockerfile(front)](https://www.notion.so/Dockerfile-front-996cd1dd5aee4ca49fd93884a665996e)
    
    [docker-compose.yml(front)](https://www.notion.so/docker-compose-yml-front-72653d797ee249f886fbd7076a16d6df)
    
    [docker-compose.yml(back)](https://www.notion.so/docker-compose-yml-back-94eb404da9574cd8bb2d341a904e6ec3)
    
    [nginx.conf](https://www.notion.so/nginx-conf-dd7c9c4eb7d245c185b6fa2c02306876)
    

### Front Build Files

- [Dockerfile](https://www.notion.so/Dockerfile-front-996cd1dd5aee4ca49fd93884a665996e)
- [docker-compose.yml](https://www.notion.so/docker-compose-yml-front-72653d797ee249f886fbd7076a16d6df)
- [nginx.conf](https://www.notion.so/nginx-conf-dd7c9c4eb7d245c185b6fa2c02306876)

### Backend Build Files

- [Dockerfile](https://www.notion.so/Dockerfile-back-ab2bf5311e8d43028e4afa8b0d8a0214)
- [docker-compose.yml](https://www.notion.so/docker-compose-yml-back-94eb404da9574cd8bb2d341a904e6ec3)

### í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ë°°í¬ ê³¼ì •

- ìš°ë¶„íˆ¬ ì ‘ì†
    
    ```bash
    ssh -i I8A303T.pem ubuntu@i8a303.p.ssafy.io
    ```
    
- Docker ì„¤ì¹˜
    1. íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ì§„í–‰
        
        ```bash
        sudo apt-get update
        ```
        
    2. í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜
        
        ```bash
        sudo apt-get install \
        		ca-certificates \
        		curl \
        		gnupg \
        		lsb-release
        ```
        
    3. ë„ì»¤ì˜ Official GPG Keyë¥¼ ë“±ë¡
        
        ```bash
        sudo mkdir -p /etc/apt/keyrings
        
        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
        ```
        
    4. stable repository ë“±ë¡
        
        ```bash
        echo \
        		"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
          $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null)
        ```
        
    5. ë„ì»¤ì™€ ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜
        
        ```bash
        # ë„ì»¤ ì„¤ì¹˜
        sudo apt-get update
        sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
        
        # ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜
        sudo apt install docker-compose
        ```
        
    6. ë„ì»¤ì™€ ë„ì»¤ ì»´í¬ì¦ˆ í™•ì¸
        
        ```bash
        # ë„ì»¤ ì„¤ì¹˜ í™•ì¸
        sudo docker -v
        
        # ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜ í™•ì¸
        sudo docker-compose -v  
        ```
        
- ì  í‚¨ìŠ¤ ì„¤ì¹˜ ë° ê³„ì • ìƒì„±
    1. docker-compose.yml ì‘ì„±
        
        ```yaml
        # docker-compose.yml
        version: '3.4'
        
        services:
        	jenkins:
        		image: jenkins/jenkins:lts
        		user: root
        		restart: always
        		container_name: jenkins
        		volumes:
        			- ./jenkins:/var/jenkins_home
        			- /var/run/docker.sock:/var/run/docker.sock
        		port:
        			- 8080:8080
        ```
        
    2. ë„ì»¤ ì»´í¬ì¦ˆ íŒŒì¼ë¡œ ì»¨í…Œì´ë„ˆ ë„ìš°ê¸°
        
        ```bash
        sudo docker-compose up -d
        ```
        
    3. ì  í‚¨ìŠ¤ë‚´ì—ì„œ docker commandë¥¼ ì‹¤í–‰ì‹œì¼œì•¼ í•˜ê¸° ë•Œë¬¸ì— ë„ì»¤ ì„¤ì¹˜
        
        ```bash
        # ì  í‚¨ìŠ¤ ì ‘ì†
        sudo docker exec -it jenkins bash
        
        # ì  í‚¨ìŠ¤ ì•ˆì— ë„ì»¤ ì„¤ì¹˜
        curl -fsSL https://get.docker.com -o get-docker.sh
        sh get-docker.sh
        ```
        
    4. ì  í‚¨ìŠ¤ admin ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        
        ```bash
        sudo docker logs jenkins
        ```
        
    5. ì  í‚¨ìŠ¤ì— ì ‘ì†í•´ì„œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í›„ ê¸°ë³¸ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
        
        ```
        http://i8a303.p.ssafy.io:8080/
        ```
        
    6. Create First Admin User
        - ê³„ì •ëª… : wow
        - ë¹„ë°€ë²ˆí˜¸ : wowssafy
- ì  í‚¨ìŠ¤ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
    
    **Git**
    
    - Generic Webhook Trigger Plugin
    - Git Server Plugin
    - Git Branch Source Plugin
    - GitLab
    - GitLab Authentication plugin
    - Pipiline: GitHub Grrovy Libraries
    
    **Docker**
    
    - Docker Commons Build Step Plugin
    - Docker pipeline
    - Docker plugin
    - docker-build-step
    
    **Build**
    
    - Gradle Plugin
    - JavaMail API
    - Email Extension Plugin
    - NodeJS Plugin
    - Oracle Java SE Development Kit Installer Plugin
- ì  í‚¨ìŠ¤ ì•„ì´í…œ ìƒì„±ê³¼ WebHook ì„¤ì •
    1. Credential ìƒì„±
        - Username : gitlabì˜ ì‚¬ìš©ì id
        - Password : gitlabì˜ ì‚¬ìš©ì password
        - ID : Credentialsë¥¼ êµ¬ë¶„í•˜ëŠ” ID
    2. ì•„ì´í…œ ìƒì„±
        - intube-front (Freestyle project)
        - intube-back (Freestyle project)
        
        <aside>
        ğŸ’¡ frontì™€ backì„ ë”°ë¡œ ìƒì„±í•´ì„œ ê´€ë¦¬í–ˆë‹¤
        
        </aside>
        
    3. ì†ŒìŠ¤ ì½”ë“œ ê´€ë¦¬
        - Repositories
            - Repository URL : [https://lab.ssafy.com/s08-webmobile1-sub2/S08P12A303.git](https://lab.ssafy.com/s08-webmobile1-sub2/S08P12A303.git)
            - Credentials : ìœ„ì—ì„œ ë§Œë“  Credentialë¡œ ì§€ì •
        - Branches to build
            - Branch Specifier
                - intube-front : */FE
                - intube-back : */BE
    4. ë¹Œë“œ ìœ ë°œ
        - Build when a change is pushed to GitLab. GitLab webhook URL: **http://52.78.72.74:8080/project/intube-front**
            - Push Events
            - Accepted Merge Request Events
            - Closed Merge Request Events
        - Allowed branches
            - Filter branches by name
                - Include
                    - intube-front : FE
                    - intube-back : BE
    5. Gitlabì—ì„œ Webhooks ì„¤ì •
        - Gitlab â†’ Settings â†’ Webhooksë¡œ ì´ë™
        - URL
            - http://52.78.72.74:8080/project/intube-front
            - http://52.78.72.74:8080/project/intube-back
        - Secret token : ì  í‚¨ìŠ¤ì—ì„œ ë§Œë“  Secret token
- ì  í‚¨ìŠ¤ ë¹Œë“œ ì„¤ì •
    - intube-front
        1. ì  í‚¨ìŠ¤ ì ‘ì† â†’ Jenkins ê´€ë¦¬ â†’ Global Tool Configurationìœ¼ë¡œ ì´ë™
        2. NodeJS intallations ì¶”ê°€
        3. Version : NodeJS 18.12.1
        4. intube-front â†’ Configurationìœ¼ë¡œ ì´ë™
        5. Build Steps
            - Execute NodeJS script : ë°©ê¸ˆ ìƒì„±í•œ NodeJS Installation ì¶”ê°€
            - Execute shell
                
                ```bash
                cd frontend
                npm install
                CI=false npm run build
                docker container stop frontend-application-1
                docker container rm frontend-application-1
                docker image rm frontend-application:latest
                docker compose up --build --force-recreate -d
                ```
                
    - intube-back
        1. ì  í‚¨ìŠ¤ ì„œë²„ ì ‘ì†
            
            ```bash
            sudo docker exec -it jenkins bash
            ```
            
        2. /var/jenkins_home/env ë””ë ‰í† ë¦¬ì— application.propertiesë¥¼ ìƒì„±
            
            <aside>
            ğŸ’¡ application.propertiesë¥¼ gitignoreì— ì¶”ê°€í–ˆê¸° ë•Œë¬¸ì— ë”°ë¡œ ì„œë²„ì— ì €ì¥í•´ì£¼ëŠ” ê³¼ì •ì´ë‹¤
            
            </aside>
            
            ```bash
            cd var/jenkins_home/env
            
            vim application.properties
            ```
            
            ```bash
            # application.properties
            
            #it will be set build date by gradle. if this value is @build.date@, front-end is development mode
            build.date=@build.date@
            server.port=8081
            server.address=0.0.0.0
            server.servlet.contextPath=/api
            # Charset of HTTP requests and responses. Added to the "Content-Type" header if not set explicitly.
            server.servlet.encoding.charset=UTF-8
            # Enable http encoding support.
            server.servlet.encoding.enabled=true
            # Force the encoding to the configured charset on HTTP requests and responses.
            server.servlet.encoding.force=true
            
            # for SPA
            spring.web.resources.static-locations=classpath:/dist/
            spa.default-file=/dist/index.html
            spring.mvc.throw-exception-if-no-handler-found=true
            spring.web.resources.add-mappings=false
            
            # Swagger
            springfox.documentation.swagger.use-model-v3=false
            
            #database
            spring.jpa.hibernate.naming.implicit-strategy=org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy
            spring.jpa.hibernate.naming.physical-strategy=org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy
            spring.jpa.hibernate.ddl-auto=update
            spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57Dialect
            spring.data.web.pageable.one-indexed-parameters=true
            spring.datasource.url=jdbc:mysql://db-mysql:3306/intube?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Seoul&zeroDateTimeBehavior=convertToNull&rewriteBatchedStatements=true
            spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
            spring.datasource.hikari.username=root
            spring.datasource.hikari.password=ssafy
            
            # jwt
            jwt.secret.access=dyAeHubOOc8KaOfYB6XEQoEj1QzRlVgtjNL8PYs1A1tymZvvqkcEU7L1imkKHeDa
            jwt.secret.refresh=236979CB6F1AD6B6A6184A31E6BE37DB3818CC36871E26235DD67DCFE4041492
            # unit is ms. 15 * 24 * 60 * 60 * 1000 = 15days
            jwt.expiration.access=3600000
            jwt.expiration.refresh=7200000
            #jwt.expiration.access=60000
            #jwt.expiration.refresh=300000
            
            #logging
            logging.file.name=./ssafy-web.log
            logging.level.root=INFO
            logging.level.com.samsung.security=DEBUG
            logging.level.org.springframework.web=DEBUG
            logging.level.org.apache.tiles=INFO
            logging.level.org.sringframework.boot=DEBUG
            logging.level.org.sringframework.security=DEBUG
            
            spring.devtools.livereload.enabled=true
            
            #gzip compression
            server.compression.enabled=true
            server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,application/javascript,text/css
            
            #for health check
            management.servlet.context-path=/manage
            management.health.db.enabled=true
            management.health.default.enabled=true
            management.health.diskspace.enabled=true
            
            #cycle????
            #spring.main.allow-circular-references=true
            
            #Redis
            spring.cache.type=redis
            spring.redis.host=db-redis
            spring.redis.port=6479
            
            #Email
            mail.smtp.auth=true
            mail.smtp.starttls.required=true
            mail.smtp.starttls.enable=true
            mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory
            mail.smtp.socketFactory.fallback=false
            mail.smtp.port=465
            mail.smtp.socketFactory.port=465
            
            #Admin Google Account
            AdminMail.id=jyj01068662778@gmail.com
            AdminMail.password=nrkpjbyejlbdalma
            
            #Multipart
            spring.servlet.multipart.max-file-size=100MB
            spring.servlet.multipart.max-request-size=100MB
            
            #AWS S3
            cloud.aws.s3.bucket=303-intube
            cloud.aws.region.static=ap-northeast-2
            cloud.aws.stack.auto=false
            
            #AWS IAM
            cloud.aws.credentials.access-key=AKIAXT4ZXOT34QFGJQ64
            cloud.aws.credentials.secret-key=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
            
            #Openvidu
            server.ssl.enabled= false
            #OPENVIDU_URL= http://localhost:4443/
            #OPENVIDU_SECRET= MY_SECRET
            OPENVIDU_URL=https://intube.store:8443
            OPENVIDU_SECRET=MY_SECRET
            ```
            
        3. intube-back â†’ Configurationìœ¼ë¡œ ì´ë™
        4. Build Steps
            - Execute shell
                
                ```bash
                cp /var/jenkins_home/env/application.properties ${WORKSPACE}/backend/src/main/resources
                cd backend
                chmod +x gradlew
                ./gradlew --stacktrace clean build -x test 
                docker container stop backend-application-1
                docker container rm backend-application-1
                docker image rm backend-application:latest
                docker compose up --build -d
                ```
                
- Nginx ì„¤ì •ê³¼ ssl ì¸ì¦ì„œ ë°œê¸‰ ë° ì ìš©
    1. Nginx ì„¤ì •
        
        ```bash
        sudo apt-get install nginx
        ```
        
    2. ì„¤ì¹˜ í™•ì¸
        
        ```bash
        sudo nginx -v
        ```
        
    3. Nginx ì¤‘ì§€
        
        ```bash
        sudo systemctl stop nginx
        ```
        
    4. Letâ€™s Encrypt ì„¤ì¹˜
        
        ```bash
        sudo apt-get install letencrypt
        ```
        
    5. ì¸ì¦ì„œ ì ìš© ë° .pem í‚¤
        
        ```bash
        sudo letsencrypt certonly --standalone -d intube.store
        ```
        
    6. ë°œê¸‰ ê²½ë¡œ í™•ì¸
        
        ```bash
        cd /etc/letsencrypt/live/intube.store
        ```
        
    7. ì´ë™ í›„ conf íŒŒì¼ ìƒì„±
        
        ```bash
        cd /etc/nginx/sites-available
        sudo vim test.conf
        ```
        
        ```bash
        # test.conf
        server {
                location / {
                        proxy_pass http://localhost:3030;
                }
        
                location /api {
                        proxy_pass http://localhost:8081/api;
                }
        
          listen 443 ssl;
          server_name intube.store;
        
          # ssl ì¸ì¦ì„œ ì ìš©í•˜ê¸°
          ssl_certificate /etc/letsencrypt/live/intube.store/fullchain.pem;
          ssl_certificate_key /etc/letsencrypt/live/intube.store/privkey.pem;
        
        }
        server {
            if ($host = intube.store) {
                return 301 https://$host$request_uri;
            } # managed by Certbot
        
          listen 80;
          server_name intube.store;
            return 404; # managed by Certbot
        }
        ```
        
    8. íŒŒì¼ ì—°ë™ ë° í…ŒìŠ¤íŠ¸
        
        ```bash
        sudo ln -s /etc/nginx/sites-available/test.conf /etc/nginx/sites-enabled/test.conf
        sudo nginx -t
        ```
        
    9. Nginx ì¬ì‹œì‘
        
        ```bash
        sudo systemctl restart nginx
        ```
        
    10. Nginx ìƒíƒœ í™•ì¸
        
        ```bash
        sudo systemctl status nginx
        ```
        
- Openvidu ì„¤ì¹˜ì™€ ì„¤ì •
    
    <aside>
    ğŸ’¡ OpenviduëŠ” ì´ë¯¸ **80,443,3478,5442,6479,8888** í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤
    
    </aside>
    
    1. Openviduë¥¼ ì„¤ì¹˜í•˜ë ¤ë©´ root ê¶Œí•œì´ í•„ìš”
        
        ```bash
        sudo su
        ```
        
    2. Openvidu ì„¤ì¹˜ê°€ ê¶Œì¥ë˜ëŠ” ìœ„ì¹˜ì¸ opt ë””ë ‰í† ë¦¬ë¡œ ì´ë™
        
        ```bash
        cd /opt
        ```
        
    3. Openvidu  ì„¤ì¹˜
        
        ```bash
        curl https://s3-eu-west-1.amazonaws.com/aws.openvidu.io/install_openvidu_latest.sh | bash
        ```
        
    4. ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ openvidu ë””ë ‰í† ë¦¬ì—ì„œ .env íŒŒì¼ ì„¤ì •
        
        ```bash
        # ë””ë ‰í† ë¦¬ ì´ë™
        cd openvidu
        
        # .env íŒŒì¼ ìƒì„±
        vim .env
        ```
        
        ```bash
        # OpenVidu configuration
        # ----------------------
        DOMAIN_OR_PUBLIC_IP=intube.store
        
        # OpenVidu SECRET used for apps to connect to OpenVidu server and users to access to OpenVidu Dashboard
        OPENVIDU_SECRET=MY_SECRET
        
        # Certificate type:
        # - letsencrypt: Generate a new certificate using letsencrypt. Please set the
        #                required contact email for Let's Encrypt in LETSENCRYPT_EMAIL
        #                variable.
        CERTIFICATE_TYPE=letsencrypt
        
        # If CERTIFICATE_TYPE=letsencrypt, you need to configure a valid email for notifications
        LETSENCRYPT_EMAIL=abcdq12345@naver.com
        
        # Proxy configuration
        # If you want to change the ports on which openvidu listens, uncomment the following lines
        
        # Allows any request to http://DOMAIN_OR_PUBLIC_IP:HTTP_PORT/ to be automatically
        # redirected to https://DOMAIN_OR_PUBLIC_IP:HTTPS_PORT/.
        # WARNING: the default port 80 cannot be changed during the first boot
        # if you have chosen to deploy with the option CERTIFICATE_TYPE=letsencrypt
        HTTP_PORT=8880
        
        # Changes the port of all services exposed by OpenVidu.
        # SDKs, REST clients and browsers will have to connect to this port
        HTTPS_PORT=8443
        
        # Whether to enable recording module or not
        OPENVIDU_RECORDING=true
        
        # ~~~
        
        # if true any client can connect to
        # https://OPENVIDU_SERVER_IP:OPENVIDU_PORT/recordings/any_session_file.mp4
        # and access any recorded video file. If false this path will be secured with
        # OPENVIDU_SECRET param just as OpenVidu Server dashboard at
        # https://OPENVIDU_SERVER_IP:OPENVIDU_PORT
        # Values: true | false
        OPENVIDU_RECORDING_PUBLIC_ACCESS=true
        
        # ~~~
        ```
        
    5. Openvidu ì‹œì‘
        
        ```bash
        ./openvidu start
        ```
        
    6. ì‹¤í–‰ì´ ì˜ ë˜ëŠ”ì§€ í™•ì¸
        
        ```bash
        https://intube.store:8443
        ```
        

# ğŸ’¡ ì™¸ë¶€ ì„œë¹„ìŠ¤

### Kakao Login

- OAuth ê¸°ë°˜ ì†Œì…œ ë¡œê·¸ì¸ API ì œê³µ
    
    [ì¹´ì¹´ì˜¤ê³„ì •](https://developers.kakao.com/console/app/854042)
    

### Google SMTP

- ì´ë©”ì¼ ì¸ì¦, ë¹„ë°€ë²ˆí˜¸ ì¬ìƒì„± ì½”ë“œë¥¼ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•˜ëŠ” email ì„œë¹„ìŠ¤

### AWS S3

- ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤
    
    [](https://s3.console.aws.amazon.com/s3/buckets?region=ap-northeast-2)
    
- ë²„í‚· ì´ë¦„ : ****303-intube
- ê¶Œí•œ : Public access í—ˆìš©
- ë²„í‚· ì •ì±…
    
    ```
    {
        "Version": "2012-10-17",
        "Id": "Policy1674643420854",
        "Statement": [
            {
                "Sid": "Stmt1674643411770",
                "Effect": "Allow",
                "Principal": "*",
                "Action": "s3:GetObject",
                "Resource": "arn:aws:s3:::303-intube/*"
            }
        ]
    }
    ```
    
- CORS
    
    ```
    [
        {
            "AllowedHeaders": [
                "*"
            ],
            "AllowedMethods": [
                "GET",
                "PUT",
                "POST",
                "HEAD"
            ],
            "AllowedOrigins": [
                "*"
            ],
            "ExposeHeaders": [
                "x-amz-server-side-encryption",
                "x-amz-request-id",
                "x-amz-id-2"
            ],
            "MaxAgeSeconds": 3000
        }
    ]
    ```
